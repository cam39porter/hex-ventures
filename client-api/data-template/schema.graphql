type SearchResults {
  graph: Graph! # for generating the graph visualization,
  list: [ListItem]! # for generating list results
  pageInfo: PageInfo!
}

type ListItem {
  id: String!
  text: AnnotatedText!
  reasons: [RecommendationReason]! # empty if root item
  relatedItems: [ListItem]
}

type RecommendationReason {
  reasonType: ReasonType!
  pivot: String
}

enum ReasonType {
  SHARES_TAG
  SHARES_ENTITY
  SHARES_LINK
  SHARES_SESSION
  SHARES_IMPORT_NOTE
  PREVIOUS
  COMMENTED_ON
  DEFAULT
}

type AnnotatedText {
  text: String!
  annotations: [Annotation!]!
}

type Annotation {
  type: AnnotationType!
  start: Int!
  end: Int!
}

enum AnnotationType {
  HIGHLIGHT
}

type Graph {
  nodes: [Node!]!
  edges: [Edge!]!
}

type Edge {
  source: String!
  destination: String!
  type: EdgeType!
  salience: Float
}

type Node {
  id: String!
  type: NodeType!
  text: String!
  level: Int
}

enum NodeType {
  Capture
  Entity
  Tag
  Session
  Link
}

enum EdgeType {
  REFERENCES
  TAGGED_WITH
  INCLUDES
  LINKS_TO
  COMMENTED_ON
  PREVIOUS
}

type PageInfo {
  start: Int!
  count: Int!
  total: Int!
}

schema {
  query: Query
  mutation: Mutation
}

type Query {
  search(rawQuery: String!, start: Int = 0, count: Int = 10): SearchResults!
  get(id: String!): Graph!
  getDetailed(id: String!): SearchResults!
  getAll(useCase: String!, timezoneOffset: Int): SearchResults!
}

enum GetAllUseCase {
  CAPTURED_TODAY
}

enum CaptureRelationType {
  COMMENTED_ON
  PREVIOUS
}

input CaptureRelation {
  captureId: String
  relationshipType: CaptureRelationType
}

type Mutation {
  createCapture(
    body: String!
    sessionId: String
    captureRelation: CaptureRelation
  ): Graph!
  createSession(title: String): Node!
  editSession(id: String!, title: String!): Node!
  archiveCapture(id: String!): Boolean
  editCapture(id: String!, body: String!): Boolean
  dismissCaptureRelation(fromId: String!, toId: String!): Boolean
}
